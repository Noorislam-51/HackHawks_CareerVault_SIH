<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Staff Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/stylesheets/staffDashboard.css">
</head>

<body>
  <header class="header">
    <h1>
      <span class="icon">ğŸ‘¥</span>
      Staff Dashboard
    </h1>
    <a href="#" class="staff-portal-btn">Staff Portal</a>
  </header>

  <div class="container">
    <!-- Statistics Cards -->
    <div class="stats-grid">
      <div class="stat-card pending">
        <div class="stat-info">
          <h3>Pending Documents</h3>
          <div class="number">3</div>
        </div>
        <div class="stat-icon">â°</div>
      </div>

      <div class="stat-card verified">
        <div class="stat-info">
          <h3>Verified Documents</h3>
          <div class="number">2</div>
        </div>
        <div class="stat-icon">âœ…</div>
      </div>

      <div class="stat-card total">
        <div class="stat-info">
          <h3>Total Students</h3>
          <div class="number">156</div>
        </div>
        <div class="stat-icon">ğŸ“</div>
      </div>

      <div class="stat-card month">
        <div class="stat-info">
          <h3>This Month</h3>
          <div class="number">89</div>
        </div>
        <div class="stat-icon">ğŸ“…</div>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="nav-tabs">
      <a href="#" class="nav-tab active" data-tab="masterDB-documents">
        ğŸ“¤ Upload Document To MasterDB
      </a>
      <a href="#" class="nav-tab" data-tab="pending-documents">
        â° Pending Documents
      </a>
      <!-- <a href="#" class="nav-tab" data-tab="verified-documents">
        âœ… Verified Documents
      </a> -->
      <a href="#" class="nav-tab" data-tab="upload-attendance">
        ğŸ“‹ Attendance
      </a>
      <a href="#" class="nav-tab" data-tab="spi-upload">
        ğŸ“Š Marksheets
      </a>
    </div>

    <!-- Master DB Tab -->
    <!-- <div class="content-section tab-content" id="masterDB-documents"> -->
    <%- include("./partials/UploadMasterDBTab") %>
      <!-- </div> -->

      <!-- Pending Documents Tab -->
      <!-- <div class="content-section tab-content" id="pending-documents"> -->
      <%- include("./partials/VerificationTab") %>
        <!-- </div> -->

        <!-- Verified Documents Tab -->
        <!-- <div class="content-section tab-content" id="verified-documents"> -->
        <!-- <%- include("./partials/VerifiedDocumentTab") %> -->
          <!-- </div> -->

          <!-- Attendance Upload Tab -->
          <!-- <div class="content-section tab-content" id="upload-attendance"> -->
          <%- include("./partials/UploadAttendanceTab") %>
            <!-- </div> -->

            <!-- Upload SPI / Marksheets Tab -->
            <!-- <div class="content-section tab-content" id="spi-upload"> -->
            <%- include("./partials/UploadSpiTab") %>
              <!-- </div> -->


  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // Tab functionality
      const tabs = document.querySelectorAll('.nav-tab');
      const tabContents = document.querySelectorAll('.tab-content');

      function switchTab(targetTab) {
        tabs.forEach(t => t.classList.remove('active'));
        tabContents.forEach(c => c.classList.remove('active'));

        const activeTab = document.querySelector(`[data-tab="${targetTab}"]`);
        const activeContent = document.getElementById(targetTab);

        if (activeTab && activeContent) {
          activeTab.classList.add('active');
          activeContent.classList.add('active');
        }
      }

      tabs.forEach(tab => {
        tab.addEventListener('click', function (e) {
          e.preventDefault();
          const targetTab = this.getAttribute('data-tab');
          switchTab(targetTab);
        });
      });

      // Form validation
      const form = document.querySelector('.needs-validation');
      if (form) {
        form.addEventListener('submit', function (event) {
          if (!form.checkValidity()) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        });
      }

      // Approve/Reject functionality
      function setupActionButtons() {
        document.querySelectorAll('.btn-approve').forEach(btn => {
          btn.addEventListener('click', function () {
            if (confirm('Are you sure you want to approve this document?')) {
              alert('Document approved!');
              const row = this.closest('tr');
              if (row) {
                row.style.opacity = '0.5';
                row.style.pointerEvents = 'none';
              }
            }
          });
        });

        document.querySelectorAll('.btn-reject').forEach(btn => {
          btn.addEventListener('click', function () {
            if (confirm('Are you sure you want to reject this document?')) {
              alert('Document rejected!');
              const row = this.closest('tr');
              if (row) {
                row.style.opacity = '0.5';
                row.style.pointerEvents = 'none';
              }
            }
          });
        });

        document.querySelectorAll('.btn-view').forEach(btn => {
          btn.addEventListener('click', function () {
            alert('View functionality would open document details here');
          });
        });

        document.querySelectorAll('.btn').forEach(btn => {
          if (btn.textContent.includes('Generate')) {
            btn.addEventListener('click', function () {
              alert('Marksheet generation would start here');
            });
          }
        });
      }

      // Search functionality
      function setupSearch(searchId, tbodyId) {
        const searchBox = document.getElementById(searchId);
        const tbody = document.getElementById(tbodyId);

        if (searchBox && tbody) {
          searchBox.addEventListener('input', function () {
            const searchTerm = this.value.toLowerCase();
            const rows = tbody.querySelectorAll('tr');

            rows.forEach(row => {
              const cells = row.querySelectorAll('td');
              if (cells.length >= 2) {
                const studentId = cells[0].textContent.toLowerCase();
                const name = cells[1].textContent.toLowerCase();
                const isVisible = studentId.includes(searchTerm) || name.includes(searchTerm);
                row.style.display = isVisible ? '' : 'none';
              }
            });
          });
        }
      }

      // Filter functionality
      function setupFilter(filterId, tbodyId) {
        const filterSelect = document.getElementById(filterId);
        const tbody = document.getElementById(tbodyId);

        if (filterSelect && tbody) {
          filterSelect.addEventListener('change', function () {
            const filterValue = this.value.toLowerCase();
            const rows = tbody.querySelectorAll('tr');

            rows.forEach(row => {
              if (filterValue === '') {
                row.style.display = '';
              } else {
                const cells = row.querySelectorAll('td');
                let shouldShow = false;

                // Check different columns based on the table type
                if (filterId.includes('pending') || filterId.includes('verified')) {
                  // For document tables, check document type
                  if (cells.length >= 3) {
                    const docType = cells[2].textContent.toLowerCase();
                    shouldShow = docType.includes(filterValue);
                  }
                } else if (filterId.includes('attendance')) {
                  // For attendance table, check class
                  if (cells.length >= 3) {
                    const className = cells[2].textContent.toLowerCase();
                    shouldShow = className.includes(filterValue);
                  }
                } else if (filterId.includes('marksheets')) {
                  // For marksheets table, check semester
                  if (cells.length >= 3) {
                    const semester = cells[2].textContent.toLowerCase();
                    shouldShow = semester.includes(filterValue.replace('sem', 'semester'));
                  }
                }

                row.style.display = shouldShow ? '' : 'none';
              }
            });
          });
        }
      }

      // Initialize all functionality
      setupActionButtons();
      setupSearch('pending-search', 'pending-tbody');
      setupSearch('verified-search', 'verified-tbody');
      setupSearch('attendance-search', 'attendance-tbody');
      setupSearch('marksheets-search', 'marksheets-tbody');

      setupFilter('pending-filter', 'pending-tbody');
      setupFilter('verified-filter', 'verified-tbody');
      setupFilter('attendance-filter', 'attendance-tbody');
      setupFilter('marksheets-filter', 'marksheets-tbody');

      // Handle file upload validation
      const fileInput = document.getElementById('file');
      if (fileInput) {
        fileInput.addEventListener('change', function () {
          const file = this.files[0];
          if (file && file.type !== 'application/pdf') {
            alert('Please select a PDF file only.');
            this.value = '';
          }
        });
      }

      // Initialize with first tab active
      const firstTab = document.querySelector('.nav-tab[data-tab="masterDB-documents"]');
      if (firstTab) {
        switchTab('masterDB-documents');
      }
    });
  </script>
</body>

</html>